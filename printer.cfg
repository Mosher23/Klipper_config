#####################################################################
# 	Octopus Config
#####################################################################
[mcu host]
serial: /tmp/klipper_host_mcu

## Octopus Pro  --------------------------------------------------------------
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_2D0026000F5053424E363620-if00


# CAN-Bus Toolhead ---------------------------------------------------------------
[include toolhead.cfg]

[include mainsail.cfg]

[include klicky-probe.cfg]

[include z_calibration.cfg]

[include stealthburner_leds.cfg]

[include filament_runout.cfg]

[include macros.cfg]

[include resonances.cfg]

[respond]

[printer]
kinematics: corexy
max_velocity: 1000  
max_accel: 10000  			#Max 4000
max_accel_to_decel: 10000
max_z_velocity: 30	#Max 15 for 12V TMC Drivers
max_z_accel: 2000   			#Max ?
square_corner_velocity: 5.0  #Can experiment with 8.0, default 5.0



#####################################################################
# 	X/Y Stepper Settings
#####################################################################

[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 100   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc5160 stepper_x]
cs_pin: PC4
spi_software_sclk_pin: PA5
spi_software_mosi_pin: PA7
spi_software_miso_pin: PA6
interpolate: True
run_current: 1.2
hold_current: 0.7
sense_resistor: 0.075
stealthchop_threshold: 1

driver_TBL: 1
driver_TOFF: 4
driver_HSTRT: 7
driver_HEND: 9



[stepper_y]
step_pin: PG0
dir_pin: !PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: ^PG14
position_min: 0
position_endstop: 305
position_max: 305
homing_speed: 100  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc5160 stepper_y]
cs_pin: PD11
spi_software_sclk_pin: PA5
spi_software_mosi_pin: PA7
spi_software_miso_pin: PA6
interpolate: True
run_current: 1.2
hold_current: 0.7
sense_resistor: 0.075
stealthchop_threshold: 1

driver_TBL: 1
driver_TOFF: 4
driver_HSTRT: 7
driver_HEND: 9

 
#####################################################################
# 	Z Stepper Settings
#####################################################################

## In E1-Mot position
## Z0 Stepper - Front Left
[stepper_z]
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
rotation_distance: 8
microsteps: 16
full_steps_per_rotation: 200
endstop_pin: ^PG13
position_max: 300
position_min: -8
homing_speed: 7.0
second_homing_speed: 3.0
homing_retract_dist: 2.0

## Z Endstop position
position_endstop: 2


[tmc2209 stepper_z]
uart_pin: PE1
uart_address: 0
interpolate: True
run_current: 1
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 99999

driver_TBL: 2
driver_TOFF: 3 
driver_HSTRT: 4 
driver_HEND: 1
driver_PWM_GRAD: 0
driver_PWM_REG: 5


##	In E2-Mot position
##	Z1 Stepper - Rear Left
[stepper_z1]
step_pin: PC13
dir_pin: PF0
enable_pin: !PF1
rotation_distance: 8
microsteps: 16
full_steps_per_rotation: 200


[tmc2209 stepper_z1]
uart_pin: PE4
interpolate: True
run_current: 1
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 99999

driver_TBL: 2
driver_TOFF: 3 
driver_HSTRT: 4 
driver_HEND: 1
driver_PWM_GRAD: 0
driver_PWM_REG: 5
driver_HEND: 3

##	In E3-Mot position
##	Z2 Stepper - Rear Right
[stepper_z2]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 8
microsteps: 16
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: True
run_current: 1
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 99999

driver_TBL: 2
driver_TOFF: 3 
driver_HSTRT: 4 
driver_HEND: 1
driver_PWM_GRAD: 0
driver_PWM_REG: 5

##	In E4-Mot position
##	Z3 Stepper - Front Right
[stepper_z3]
step_pin: PG4
dir_pin: PC1
enable_pin: !PA0
rotation_distance: 8
microsteps: 16
full_steps_per_rotation: 200


[tmc2209 stepper_z3]
uart_pin: PC7
interpolate: True
run_current: 1
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 99999

driver_TBL: 2
driver_TOFF: 3 
driver_HSTRT: 4 
driver_HEND: 1
driver_PWM_GRAD: 0
driver_PWM_REG: 5

#####################################################################
# 	Electronic bay fan Control
#####################################################################
[heater_fan controller_fan]
pin: PD14
kick_start_time: 1.0
max_power: 1
shutdown_speed: 0.0
heater: heater_bed
heater_temp: 60.0

#####################################################################
# 	Nevermore fan control
#####################################################################
#[heater_fan exhaust_fan]
#pin: PE5
#max_power: 0.3
#shutdown_speed: 0.0
#kick_start_time: 3.0
#heater: heater_bed
#heater_temp: 100
#fan_speed: 1

[fan_generic exhaust_fan]
pin: PE5
kick_start_time: 3.0
shutdown_speed: 0.0
max_power: 1

#####################################################################
# 	Case Lights
#####################################################################
[output_pin Case_LED]
pin: PD15
#shutdown_value: 0
#scale: 10
#cycle_time: 0.001
#value: 0
#pwm: true

#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin 
heater_pin: PB11
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.6
min_temp: 0
max_temp: 120
#pwm_cycle_time: 0.02

#####################################################################
# 	Homing, QGL and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

#[safe_z_home]
##	XY Location of the Z Endstop Switch
##	Update -10,-10 to the XY coordinates of your endstop pin 
##	(such as 157,305) after going through Z Endstop Pin
##	Location Definition step.
#home_xy_position:246,305
#speed:100
#z_hop:10
   
#--------------------------------------------------------------------
##	QGL
[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
#	Probe points
points:
	30,10
	30,265
	270,265
	270,10

#--------------------------------------------------------------------
speed: 1000
horizontal_move_z: 8
retries: 5
retry_tolerance: 0.005
max_adjust: 10


#####################################################################
#### Temp Sensor Section ####
#####################################################################

[temperature_sensor chamber]
sensor_type: BME280
i2c_bus: i2c1a
gcode_id: C


[temperature_sensor Raspberry]
sensor_type: temperature_host


[temperature_sensor Octopus]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100
#####################################################################
# 	Bed Mesh
#####################################################################

[bed_mesh]
speed: 300
horizontal_move_z: 5
mesh_min: 30,30
mesh_max: 270, 270
probe_count: 5,5
mesh_pps: 2,2
algorithm: bicubic
bicubic_tension: 0.2
relative_reference_index: 13
fade_start: 1
fade_end: 3
fade_target: 0


#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 23.775
#*# pid_ki = 2.366
#*# pid_kd = 59.734
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 35.509
#*# pid_ki = 1.246
#*# pid_kd = 253.005
#*#
#*# [bed_mesh PLA]
#*# version = 1
#*# points =
#*# 	-0.057500, -0.047500, -0.035000, -0.012500, -0.007500, -0.005000, -0.005000, -0.015000, -0.030000, -0.055000
#*# 	-0.032500, -0.027500, -0.020000, -0.000000, 0.002500, 0.005000, 0.000000, -0.007500, -0.030000, -0.057500
#*# 	-0.020000, -0.012500, -0.005000, 0.020000, 0.022500, 0.017500, 0.015000, 0.010000, -0.010000, -0.042500
#*# 	-0.002500, 0.005000, 0.012500, 0.030000, 0.032500, 0.032500, 0.027500, 0.020000, 0.002500, -0.032500
#*# 	-0.002500, 0.012500, 0.017500, 0.027500, 0.037500, 0.040000, 0.027500, 0.015000, 0.005000, -0.022500
#*# 	0.005000, 0.012500, 0.017500, 0.037500, 0.042500, 0.045000, 0.040000, 0.030000, 0.010000, -0.025000
#*# 	-0.000000, 0.005000, 0.010000, 0.032500, 0.035000, 0.030000, 0.027500, 0.020000, -0.000000, -0.035000
#*# 	-0.025000, -0.017500, -0.012500, 0.005000, 0.007500, 0.015000, 0.012500, -0.002500, -0.015000, -0.045000
#*# 	-0.042500, -0.040000, -0.032500, -0.017500, -0.012500, -0.012500, -0.015000, -0.027500, -0.042500, -0.070000
#*# 	-0.085000, -0.087500, -0.080000, -0.065000, -0.057500, -0.050000, -0.050000, -0.062500, -0.072500, -0.097500
#*# tension = 0.2
#*# min_x = 30.0
#*# algo = bicubic
#*# y_count = 10
#*# mesh_y_pps = 2
#*# min_y = 30.0
#*# x_count = 10
#*# max_y = 269.94
#*# mesh_x_pps = 2
#*# max_x = 269.94
#*#
#*# [bed_mesh COLD]
#*# version = 1
#*# points =
#*# 	-0.020000, -0.031250, -0.023750, -0.007500, -0.018750, -0.008750, 0.010000, -0.000000, -0.017500, -0.030000
#*# 	-0.030000, -0.033750, -0.030000, -0.026250, -0.020000, -0.015000, 0.000000, -0.002500, -0.017500, -0.042500
#*# 	-0.027500, -0.007500, -0.023750, -0.016250, -0.010000, -0.007500, 0.000000, 0.000000, 0.002500, -0.020000
#*# 	-0.036250, -0.021250, -0.036250, -0.028750, -0.008750, -0.016250, 0.023750, -0.008750, -0.006250, -0.023750
#*# 	-0.015000, 0.005000, -0.026250, 0.011250, 0.022500, -0.010000, 0.007500, 0.018750, 0.003750, -0.022500
#*# 	-0.011250, -0.007500, -0.025000, 0.000000, -0.011250, 0.020000, 0.025000, 0.015000, -0.005000, -0.026250
#*# 	-0.003750, 0.003750, -0.007500, -0.012500, -0.008750, -0.005000, 0.013750, 0.007500, -0.003750, -0.013750
#*# 	-0.017500, -0.003750, -0.017500, -0.010000, 0.005000, 0.000000, 0.006250, 0.005000, -0.005000, -0.012500
#*# 	-0.015000, -0.017500, -0.015000, -0.006250, -0.007500, 0.003750, -0.001250, -0.006250, -0.012500, -0.020000
#*# 	-0.002500, -0.021250, -0.040000, -0.021250, -0.012500, -0.022500, -0.006250, -0.026250, -0.022500, -0.035000
#*# tension = 0.2
#*# min_x = 30.0
#*# algo = bicubic
#*# y_count = 10
#*# mesh_y_pps = 2
#*# min_y = 30.0
#*# x_count = 10
#*# max_y = 269.94
#*# mesh_x_pps = 2
#*# max_x = 269.94
#*#
#*# [bed_mesh ABS]
#*# version = 1
#*# points =
#*# 	-0.045000, -0.017500, 0.011250, 0.032500, -0.002500, 0.035000, 0.055000, 0.027500, -0.005000, -0.030000, -0.032500
#*# 	-0.022500, -0.012500, -0.022500, 0.000000, 0.022500, 0.042500, 0.012500, 0.067500, 0.020000, 0.002500, -0.037500
#*# 	-0.015000, -0.015000, 0.027500, 0.022500, 0.095000, 0.005000, 0.057500, -0.005000, 0.005000, -0.022500, -0.030000
#*# 	0.005000, 0.012500, -0.010000, -0.010000, 0.005000, 0.011250, 0.020000, -0.005000, -0.008750, 0.002500, -0.045000
#*# 	0.012500, 0.067500, 0.007500, -0.017500, 0.002500, -0.002500, 0.018750, 0.048750, -0.010000, 0.035000, -0.042500
#*# 	0.005000, 0.042500, -0.020000, 0.020000, 0.000000, 0.025000, 0.162500, 0.017500, -0.007500, -0.030000, -0.047500
#*# 	-0.015000, -0.000000, 0.012500, 0.015000, 0.060000, 0.057500, 0.085000, 0.020000, 0.005000, 0.012500, -0.040000
#*# 	-0.000000, 0.047500, -0.007500, 0.012500, 0.008750, 0.030000, 0.032500, 0.012500, 0.002500, 0.017500, -0.030000
#*# 	-0.022500, -0.010000, 0.007500, 0.030000, 0.055000, 0.055000, 0.052500, 0.032500, 0.020000, -0.010000, -0.025000
#*# 	-0.025000, -0.015000, 0.020000, 0.052500, 0.037500, 0.042500, 0.052500, 0.007500, 0.017500, -0.010000, -0.005000
#*# 	-0.002500, -0.020000, -0.022500, 0.005000, 0.027500, 0.062500, 0.042500, 0.020000, 0.022500, -0.005000, -0.050000
#*# tension = 0.2
#*# min_x = 30.0
#*# algo = bicubic
#*# y_count = 11
#*# mesh_y_pps = 2
#*# min_y = 30.0
#*# x_count = 11
#*# max_y = 270.0
#*# mesh_x_pps = 2
#*# max_x = 270.0
#*#
#*# [bed_mesh ABS+]
#*# version = 1
#*# points =
#*# 	-0.045000, -0.017500, 0.011250, 0.032500, -0.002500, 0.035000, 0.055000, 0.027500, -0.005000, -0.030000, -0.032500
#*# 	-0.022500, -0.012500, -0.022500, 0.000000, 0.022500, 0.042500, 0.012500, 0.067500, 0.020000, 0.002500, -0.037500
#*# 	-0.015000, -0.015000, 0.027500, 0.022500, 0.095000, 0.005000, 0.057500, -0.005000, 0.005000, -0.022500, -0.030000
#*# 	0.005000, 0.012500, -0.010000, -0.010000, 0.005000, 0.011250, 0.020000, -0.005000, -0.008750, 0.002500, -0.045000
#*# 	0.012500, 0.067500, 0.007500, -0.017500, 0.002500, -0.002500, 0.018750, 0.048750, -0.010000, 0.035000, -0.042500
#*# 	0.005000, 0.042500, -0.020000, 0.020000, 0.000000, 0.025000, 0.162500, 0.017500, -0.007500, -0.030000, -0.047500
#*# 	-0.015000, -0.000000, 0.012500, 0.015000, 0.060000, 0.057500, 0.085000, 0.020000, 0.005000, 0.012500, -0.040000
#*# 	-0.000000, 0.047500, -0.007500, 0.012500, 0.008750, 0.030000, 0.032500, 0.012500, 0.002500, 0.017500, -0.030000
#*# 	-0.022500, -0.010000, 0.007500, 0.030000, 0.055000, 0.055000, 0.052500, 0.032500, 0.020000, -0.010000, -0.025000
#*# 	-0.025000, -0.015000, 0.020000, 0.052500, 0.037500, 0.042500, 0.052500, 0.007500, 0.017500, -0.010000, -0.005000
#*# 	-0.002500, -0.020000, -0.022500, 0.005000, 0.027500, 0.062500, 0.042500, 0.020000, 0.022500, -0.005000, -0.050000
#*# tension = 0.2
#*# min_x = 30.0
#*# algo = bicubic
#*# y_count = 11
#*# mesh_y_pps = 2
#*# min_y = 30.0
#*# x_count = 11
#*# max_y = 270.0
#*# mesh_x_pps = 2
#*# max_x = 270.0
#*#
#*# [bed_mesh ABS-HOT]
#*# version = 1
#*# points =
#*# 	-0.055000, -0.050000, -0.043125, -0.012500, -0.004375, -0.014375, -0.019375, -0.008125, -0.028750, -0.027500, -0.031250
#*# 	-0.055625, -0.019375, -0.045000, -0.013125, -0.001250, -0.026250, -0.013750, -0.015000, -0.028750, -0.031875, -0.056250
#*# 	-0.066875, -0.056250, -0.050000, -0.048750, -0.004375, -0.001250, -0.026250, -0.018125, -0.026875, -0.055000, -0.060625
#*# 	-0.040000, -0.018125, -0.028750, -0.006250, -0.014375, -0.030000, -0.019375, -0.027500, -0.005000, -0.050625, -0.073750
#*# 	-0.062500, -0.062500, -0.036250, -0.045000, -0.014375, -0.028125, -0.029375, -0.026250, -0.087500, -0.060625, -0.061250
#*# 	-0.033125, -0.010000, 0.021250, -0.020625, 0.000000, -0.023125, -0.021250, -0.026250, -0.050000, -0.056250, -0.058750
#*# 	-0.055625, -0.040000, -0.005000, -0.028750, -0.007500, 0.022500, 0.003750, -0.017500, -0.022500, -0.027500, -0.098750
#*# 	-0.040625, -0.017500, -0.015000, -0.026250, -0.013750, -0.011250, -0.001250, -0.028125, -0.040625, -0.047500, -0.055000
#*# 	-0.022500, -0.037500, -0.026250, -0.009375, -0.005625, -0.016875, 0.003750, -0.021250, -0.048750, -0.057500, -0.076250
#*# 	-0.035625, -0.028125, -0.026250, -0.017500, -0.000625, -0.018750, 0.008750, -0.030000, -0.030625, -0.031250, 0.012500
#*# 	-0.065000, -0.046250, -0.020625, -0.019375, -0.013125, -0.020000, -0.016250, -0.023125, -0.038750, -0.045625, -0.051875
#*# tension = 0.2
#*# min_x = 30.0
#*# algo = bicubic
#*# y_count = 11
#*# mesh_y_pps = 2
#*# min_y = 30.0
#*# x_count = 11
#*# max_y = 270.0
#*# mesh_x_pps = 2
#*# max_x = 270.0
#*#
#*# [bed_mesh 110]
#*# version = 1
#*# points =
#*# 	-0.040000, -0.051875, 0.006250, -0.029375, -0.015000, 0.003750, -0.007500, -0.006250, -0.011250, -0.016250, -0.031250
#*# 	-0.040000, -0.032500, -0.028750, -0.023750, 0.003750, -0.009375, 0.012500, 0.010000, 0.025000, 0.001875, -0.020000
#*# 	-0.035000, 0.006250, 0.011250, -0.005000, 0.003750, 0.017500, 0.022500, 0.006250, 0.011250, -0.001250, 0.006250
#*# 	-0.010000, -0.011250, -0.025000, 0.012500, 0.001875, -0.005000, 0.035000, 0.022500, 0.006250, -0.011250, -0.006875
#*# 	-0.032500, -0.020000, -0.007500, -0.013750, 0.019375, 0.007500, 0.021250, 0.003750, 0.002500, -0.007500, -0.035625
#*# 	-0.016875, -0.002500, -0.008750, 0.027500, 0.000000, 0.031250, 0.033750, 0.005000, 0.025000, 0.007500, 0.005000
#*# 	-0.006250, -0.016250, 0.024375, -0.003750, 0.019375, 0.040000, 0.023750, 0.033125, 0.020625, 0.032500, 0.031250
#*# 	-0.016250, -0.010000, -0.003750, 0.010000, 0.018750, 0.012500, 0.021250, 0.025000, 0.008125, -0.010000, -0.012500
#*# 	-0.017500, -0.003750, 0.005625, 0.030000, 0.017500, -0.001250, 0.021875, 0.026250, 0.013750, 0.017500, 0.009375
#*# 	0.003750, 0.043125, -0.030625, -0.017500, -0.003750, -0.010625, 0.002500, 0.041250, 0.007500, 0.006250, -0.015000
#*# 	-0.037500, -0.034375, 0.000000, -0.005625, 0.008750, 0.002500, 0.035625, 0.018125, 0.000000, 0.005000, -0.008750
#*# tension = 0.2
#*# min_x = 30.0
#*# algo = bicubic
#*# y_count = 11
#*# mesh_y_pps = 2
#*# min_y = 30.0
#*# x_count = 11
#*# max_y = 270.0
#*# mesh_x_pps = 2
#*# max_x = 270.0
